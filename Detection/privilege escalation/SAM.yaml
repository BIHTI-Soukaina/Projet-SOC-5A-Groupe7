title: Detection of Unauthorized Access to Security Account Manager (SAM)
id: a4e91c3b-58f4-4b27-b7e1-samaccess
status: experimental
logsource:
  product: windows
  service: security
  eventid: 4663
selection:
  Object_Name:
    - '*\\sam'
  Account_Name:
    - '!frank'
    - '!olivia'
    - '!alice'
    - '!yara'
    - '!david'
    - '!katherine'
    - '!uma'
    - '!SRV-PRD-DC$'
    - '!SRV-PRD-WEB$'
    - '!SRV-PRD-DB$'
    - '!SRV-PRD-SHARE$'

fields:
  - host
  - source
  - sourcetype
  - Account_Name
  - ComputerName
  - Object_Name
  - Accesses
  - timestamp

description: >
  This rule detects unauthorized access attempts to the Security Account Manager (SAM) database. Access to SAM indicates an attempt to retrieve sensitive credential information, which may lead to privilege escalation.

detection:
  selection:
    EventID: 4663
    Object_Name: '*\\sam'
    Account_Name:
      - '!frank'
      - '!olivia'
      - '!alice'
      - '!yara'
      - '!david'
      - '!katherine'
      - '!uma'
      - '!SRV-PRD-DC$'
      - '!SRV-PRD-WEB$'
      - '!SRV-PRD-DB$'
      - '!SRV-PRD-SHARE$'
  condition: selection

tags:
  - attack.credential_access
  - attack.t1003.002
  - impact.high

librairie_de_pivots:
  - Hostname of the affected machine
  - Account attempting to access SAM
  - Object accessed and type of access requested

fiche_reflexe_remediation:
  - Restrict access to the SAM database to authorized system processes and accounts only.
  - Monitor for attempts to access SAM and investigate suspicious activities.
  - Implement enhanced logging and alerting for access attempts to critical system files like SAM.
  - Review and restrict unnecessary access rights to sensitive files to mitigate risks.

ttl: 3600
