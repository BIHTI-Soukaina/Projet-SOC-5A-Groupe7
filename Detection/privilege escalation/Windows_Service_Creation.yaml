title: Detection of Windows Service Creation by Non-Administrative Accounts
id: d7f9a3e1-33a5-4f9b-8b7a-servicecreation
status: experimental
logsource:
  product: windows
  service: security
  eventid: 4697
selection:
  Account_Name:
    - '!frank'
    - '!olivia'
    - '!alice'
    - '!yara'
    - '!david'
    - '!katherine'
    - '!uma'
    - '!SRV-PRD-DC$'
    - '!SRV-PRD-WEB$'
    - '!SRV-PRD-DB$'
    - '!SRV-PRD-SHARE$'

fields:
  - host
  - source
  - sourcetype
  - Account_Name
  - ComputerName
  - timestamp

description: >
  This rule detects the creation of new Windows services by non-administrative accounts, which may indicate an attempt to escalate privileges or maintain persistence on the system.

detection:
  selection:
    EventID: 4697
    Account_Name:
      - '!frank'
      - '!olivia'
      - '!alice'
      - '!yara'
      - '!david'
      - '!katherine'
      - '!uma'
      - '!SRV-PRD-DC$'
      - '!SRV-PRD-WEB$'
      - '!SRV-PRD-DB$'
      - '!SRV-PRD-SHARE$'
  condition: selection

tags:
  - attack.persistence
  - attack.t1050
  - impact.high

librairie_de_pivots:
  - Hostname of the affected machine
  - Account creating the service
  - Service name and configuration details

fiche_reflexe_remediation:
  - Restrict the ability to create services to authorized administrative accounts only.
  - Monitor for any new services created by standard accounts.
  - Investigate the service created, including its purpose and associated accounts, to determine if it poses a security risk.
  - Review and disable unnecessary or suspicious services to reduce the attack surface.

ttl: 3600
